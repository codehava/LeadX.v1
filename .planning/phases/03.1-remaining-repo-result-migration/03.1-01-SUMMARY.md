---
phase: 03.1-remaining-repo-result-migration
plan: 01
subsystem: error-handling
tags: [result-type, sealed-class, pattern-matching, dartz-removal]

# Dependency graph
requires:
  - phase: 03-error-classification-recovery
    provides: "Sealed Result<T> type, mapException(), runCatching() infrastructure"
provides:
  - "BrokerRepository (4 methods) returning Result<T>"
  - "AdminUserRepository (6 methods) returning Result<T>"
  - "HvcRepository (7 methods) returning Result<T>"
  - "sync_providers.dart fully dartz-free"
affects: [03.1-02, 03.1-03, 03.1-04, 03.1-05]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "runCatching for simple CRUD, explicit try/catch+mapException for validation/sync logic"
    - "switch pattern matching on Result (Success/ResultFailure) replacing .fold()"

key-files:
  created: []
  modified:
    - lib/domain/repositories/broker_repository.dart
    - lib/data/repositories/broker_repository_impl.dart
    - lib/presentation/providers/broker_providers.dart
    - lib/domain/repositories/admin_user_repository.dart
    - lib/data/repositories/admin_user_repository_impl.dart
    - lib/presentation/providers/admin_user_providers.dart
    - lib/domain/repositories/hvc_repository.dart
    - lib/data/repositories/hvc_repository_impl.dart
    - lib/presentation/providers/hvc_providers.dart
    - lib/presentation/providers/sync_providers.dart

key-decisions:
  - "linkCustomerToHvc uses explicit try/catch (not runCatching) to support early-return ValidationFailure for duplicate link check"
  - "AdminUser methods all use runCatching since they are simple online-only remote calls"

patterns-established:
  - "Consistent Result migration pattern: interface Either->Result, impl try/catch->runCatching or mapException, consumers .fold()->switch"

# Metrics
duration: 8min
completed: 2026-02-14
---

# Phase 3.1 Plan 01: Simple Repository Migration Summary

**Broker (4), AdminUser (6), and HVC (7) repositories migrated from dartz Either to sealed Result with 14 consumer .fold() sites converted to switch pattern matching**

## Performance

- **Duration:** 8 min
- **Started:** 2026-02-13T21:44:48Z
- **Completed:** 2026-02-13T21:53:05Z
- **Tasks:** 2
- **Files modified:** 10

## Accomplishments
- 17 repository methods across 3 repositories now return Result<T> instead of Either<Failure, T>
- 14 .fold() consumer call sites replaced with exhaustive switch pattern matching
- sync_providers.dart is now fully dartz-free (all sync pull results use switch)
- Zero dartz imports remain across all 10 modified files

## Task Commits

Each task was committed atomically:

1. **Task 1: Migrate BrokerRepository and AdminUserRepository to Result type** - `0082f97` (feat)
2. **Task 2: Migrate HvcRepository to Result type and update sync_providers** - `439726d` (feat)

## Files Created/Modified
- `lib/domain/repositories/broker_repository.dart` - Interface: 4 methods return Result<T>
- `lib/data/repositories/broker_repository_impl.dart` - Impl: runCatching for CRUD, mapException for sync
- `lib/presentation/providers/broker_providers.dart` - 3 .fold() sites converted to switch
- `lib/domain/repositories/admin_user_repository.dart` - Interface: 6 methods return Result<T>
- `lib/data/repositories/admin_user_repository_impl.dart` - Impl: runCatching for all 6 online-only methods
- `lib/presentation/providers/admin_user_providers.dart` - 6 .fold() sites converted to switch
- `lib/domain/repositories/hvc_repository.dart` - Interface: 7 methods return Result<T>
- `lib/data/repositories/hvc_repository_impl.dart` - Impl: runCatching for CRUD, explicit try/catch for validation/sync
- `lib/presentation/providers/hvc_providers.dart` - 5 .fold() sites converted to switch
- `lib/presentation/providers/sync_providers.dart` - 3 remaining .fold() sites (HVC, HVC links, Broker) converted

## Decisions Made
- linkCustomerToHvc uses explicit try/catch instead of runCatching to support early-return ValidationFailure for duplicate link check
- AdminUser methods all use runCatching since they are simple online-only remote calls with no local validation
- HVC failures.dart import retained because ValidationFailure is used directly in linkCustomerToHvc

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- 3 of 7 remaining repositories migrated
- Pattern well-established for next plans (KeyPerson, Score, Cadence, PipelineReferral)
- sync_providers.dart fully clean of dartz

## Self-Check: PASSED

All 10 modified files verified present. Both task commits (0082f97, 439726d) verified in git log.

---
*Phase: 03.1-remaining-repo-result-migration*
*Completed: 2026-02-14*
