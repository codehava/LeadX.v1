---
phase: 03.1-remaining-repo-result-migration
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/domain/repositories/cadence_repository.dart
  - lib/data/repositories/cadence_repository_impl.dart
  - lib/presentation/providers/cadence_providers.dart
  - lib/presentation/screens/cadence/cadence_detail_screen.dart
  - lib/presentation/screens/cadence/host_dashboard_screen.dart
  - lib/presentation/screens/cadence/cadence_form_screen.dart
autonomous: true

must_haves:
  truths:
    - "CadenceRepository interface and impl return Result<T> instead of Either<Failure, T>"
    - "All 5 Either<Failure, Unit> return types replaced with Result<void>"
    - "Internal .fold() in batchMarkAttendance replaced with switch pattern matching"
    - "All .fold() call sites across 4 consumer files use switch pattern matching"
    - "flutter analyze passes with no errors on modified files"
  artifacts:
    - path: "lib/domain/repositories/cadence_repository.dart"
      provides: "Cadence repository interface with Result<T> and Result<void>"
      contains: "Result<"
    - path: "lib/data/repositories/cadence_repository_impl.dart"
      provides: "Cadence repository impl using runCatching/mapException, no dartz Unit"
      contains: "runCatching"
    - path: "lib/presentation/providers/cadence_providers.dart"
      provides: "Cadence providers with switch pattern matching"
      contains: "case Success"
  key_links:
    - from: "lib/data/repositories/cadence_repository_impl.dart"
      to: "markAttendance result in batchMarkAttendance"
      via: "switch pattern matching on internal Result (replacing internal .fold())"
      pattern: "case Success|case ResultFailure"
    - from: "lib/presentation/providers/cadence_providers.dart"
      to: "CadenceRepository"
      via: "switch pattern matching on Result"
      pattern: "case Success|case ResultFailure"
    - from: "lib/presentation/screens/cadence/cadence_detail_screen.dart"
      to: "CadenceRepository via providers"
      via: "switch pattern matching on Result"
      pattern: "case Success|case ResultFailure"
---

<objective>
Migrate CadenceRepository (18 methods) from dartz Either<Failure, T> to sealed Result<T>, handling the special Unit->void conversion and internal .fold() in batchMarkAttendance, and updating all 4 consumer files.

Purpose: Cadence is the highest method-count repository (18 methods) with two unique challenges: (1) dartz Unit used in 5 return types must become Result<void>, and (2) batchMarkAttendance has an internal .fold() call on markAttendance results within the repository implementation itself.
Output: 6 files updated (1 interface, 1 impl, 4 consumers).
</objective>

<execution_context>
@C:/Users/cartr/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cartr/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.1-remaining-repo-result-migration/03.1-RESEARCH.md
@.planning/phases/03-error-classification-recovery/03-01-SUMMARY.md
@lib/core/errors/result.dart
@lib/core/errors/exception_mapper.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate CadenceRepository interface and implementation</name>
  <files>
    lib/domain/repositories/cadence_repository.dart
    lib/data/repositories/cadence_repository_impl.dart
  </files>
  <action>
    **CadenceRepository interface (18 Either methods):**

    1. `lib/domain/repositories/cadence_repository.dart`:
       - Replace `import 'package:dartz/dartz.dart'` with `import '../../core/errors/result.dart'`
       - Change all `Future<Either<Failure, T>>` to `Future<Result<T>>`
       - CRITICAL: Change all `Future<Either<Failure, Unit>>` to `Future<Result<void>>` -- there are 5 of these (Unit is a dartz type, must become void)
       - Remove any remaining dartz import (Unit was the main reason for it)

    **CadenceRepository implementation (18 methods + internal .fold()):**

    2. `lib/data/repositories/cadence_repository_impl.dart`:
       - Replace `import 'package:dartz/dartz.dart'` with `import '../../core/errors/exception_mapper.dart'` and `import '../../core/errors/result.dart'`
       - For the 5 methods returning `Either<Failure, Unit>`:
         - Replace `const Right(unit)` / `Right(unit)` with `Result.success(null)` (Result<void> uses null as success value)
         - Return type becomes `Future<Result<void>>`
       - For simple CRUD methods (toggleConfigActive, deleteConfig, updateMeetingNotes, updateMeetingAgenda, saveFormDraft, saveFeedback, saveHostNotes, markAttendance, ensureUpcomingMeetings): use `runCatching`
       - For complex methods with validation/multi-step (createConfig, updateConfig, startMeeting, endMeeting, cancelMeeting, submitPreMeetingForm, batchMarkAttendance): use explicit try/catch + mapException
       - Replace all `Left(DatabaseFailure(...))` with `Result.failure(mapException(e, context: ...))`
       - Replace all `Right(value)` with `Result.success(value)`
       - CRITICAL internal .fold() fix in `batchMarkAttendance()` (~line 766):
         Replace:
         ```dart
         result.fold(
           (failure) => throw Exception(failure.message),
           (participant) => results.add(participant),
         );
         ```
         With:
         ```dart
         switch (result) {
           case Success(:final value):
             results.add(value);
           case ResultFailure(:final failure):
             throw Exception(failure.message);
         }
         ```
         This internal call invokes `markAttendance()` which also returns Result now, so the switch is on Result type.
  </action>
  <verify>
    Run `flutter analyze` -- zero errors in the 2 modified files. Verify:
    - No `import 'package:dartz/dartz.dart'` in either file
    - No `Left(` or `Right(` or `unit` (dartz Unit) in cadence_repository_impl.dart
    - `grep "Result<void>" lib/domain/repositories/cadence_repository.dart` shows 5 occurrences (or however many had Unit)
  </verify>
  <done>
    CadenceRepository interface (18 methods) and implementation migrated to Result<T>. 5 Unit return types converted to void. Internal .fold() in batchMarkAttendance replaced with switch. All Left/Right replaced with Result.failure/Result.success. flutter analyze clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate all 4 cadence consumer files from .fold() to switch</name>
  <files>
    lib/presentation/providers/cadence_providers.dart
    lib/presentation/screens/cadence/cadence_detail_screen.dart
    lib/presentation/screens/cadence/host_dashboard_screen.dart
    lib/presentation/screens/cadence/cadence_form_screen.dart
  </files>
  <action>
    **Cadence providers:**

    1. `cadence_providers.dart` (10 .fold() call sites -- HIGHEST count of any consumer file):
       - Replace all 10 `.fold((failure) => ..., (value) => ...)` calls with switch pattern matching
       - For methods that returned Unit, the Success case won't destructure value (use `case Success()` without `:final value`)
       - Add result.dart import, remove dartz import

    **Cadence screens:**

    2. `cadence_detail_screen.dart` (4 .fold() call sites):
       - Replace all 4 `.fold()` calls with switch pattern matching
       - These are screen-level consumers that likely have `mounted` checks -- preserve the mounted guard inside each case
       - Add result.dart import, remove dartz import if present

    3. `host_dashboard_screen.dart` (1 .fold() site):
       - Replace the 1 `.fold()` call with switch pattern matching
       - Add result.dart import, remove dartz import if present

    4. `cadence_form_screen.dart` (2 .fold() sites):
       - Replace both `.fold()` calls with switch pattern matching
       - Add result.dart import, remove dartz import if present

    For ALL consumer files, use this pattern for void-returning methods:
    ```dart
    // Before: result.fold((failure) => showError(), (_) => showSuccess())
    // After:
    switch (result) {
      case Success():
        // success handler (no value to destructure for void)
      case ResultFailure(:final failure):
        // failure handler
    }
    ```
  </action>
  <verify>
    Run `flutter analyze` -- zero errors in all 4 modified files. Verify:
    - `grep -r "\.fold\(" lib/presentation/providers/cadence_providers.dart lib/presentation/screens/cadence/cadence_detail_screen.dart lib/presentation/screens/cadence/host_dashboard_screen.dart lib/presentation/screens/cadence/cadence_form_screen.dart` returns zero results
    - `grep -r "dartz" lib/presentation/providers/cadence_providers.dart lib/presentation/screens/cadence/cadence_detail_screen.dart lib/presentation/screens/cadence/host_dashboard_screen.dart lib/presentation/screens/cadence/cadence_form_screen.dart` returns zero results
  </verify>
  <done>
    All 4 cadence consumer files migrated: 10 .fold() in cadence_providers, 4 in cadence_detail_screen, 1 in host_dashboard_screen, 2 in cadence_form_screen = 17 total .fold() sites replaced with switch pattern matching. Zero dartz imports remain. flutter analyze clean.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
- Run `flutter analyze` on the full project -- no new errors
- Verify all 6 modified files have no dartz imports
- CadenceRepository (18 methods) returns Result<T>/Result<void> instead of Either<Failure, T>/Either<Failure, Unit>
</verification>

<success_criteria>
- CadenceRepository 18 methods migrated from Either to Result
- 5 Unit return types converted to void
- Internal .fold() in batchMarkAttendance converted to switch
- 17 .fold() consumer call sites across 4 files replaced with switch
- Zero dartz imports in all 6 modified files
- flutter analyze clean
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-remaining-repo-result-migration/03.1-04-SUMMARY.md`
</output>
