# Phase 03.1: Remaining Repo Result Migration - Research

**Researched:** 2026-02-14
**Domain:** Dart sealed class migration, dartz removal, error handling patterns
**Confidence:** HIGH

## Summary

This phase is a mechanical migration applying the established Pattern from Phase 3 (03-01, 03-02) to the 7 remaining repositories still using dartz `Either<Failure, T>`. The pattern is fully proven: change interface return types from `Either<Failure, T>` to `Result<T>`, replace `Left()`/`Right()` in implementations with `Result.failure()`/`Result.success()`, replace `.fold()` in consumers with `switch` pattern matching, and update tests. Once all 7 are migrated, dartz can be removed from `pubspec.yaml` and the `EitherToResult` adapter in `result.dart` can be deleted.

The 7 target repositories span three categories: (1) **Auth** -- online-only with Supabase calls, no sync queue, unique because it uses both `Left()`/`Right()` directly and has `.isLeft()` consumer patterns; (2) **Admin** (admin_user, admin_master_data) -- online-only with direct Supabase remote calls, no local DB; (3) **Offline-first** (broker, hvc, cadence, pipeline_referral) -- follow the same offline-first pattern as Customer/Pipeline/Activity with Drift local DB + sync queue, already using `Left()`/`Right()` with `DatabaseFailure` catch-all. A special consideration is CadenceRepository which uses dartz `Unit` in 5 return types (`Either<Failure, Unit>`) -- these must become `Result<void>` since `Unit` is a dartz type.

**Primary recommendation:** Apply the exact Phase 3 mechanical pattern -- no new architecture decisions needed. Group work by repository (interface + impl + providers + screens + tests in a single task per repo or group of related repos). The biggest risk is missing consumer call sites that call `.fold()` or `.isLeft()`/`.isRight()` directly on results from these repos.

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| leadx_crm `Result<T>` | N/A (custom) | Sealed result type | Already created in Phase 03-01, battle-tested in 3 repo migrations |
| leadx_crm `mapException()` | N/A (custom) | Exception-to-Failure classification | Created in Phase 03-01, classifies 6+ exception types |
| leadx_crm `runCatching()` | N/A (custom) | Async Result wrapper | Created in Phase 03-01, for simple CRUD methods |

### To Be Removed
| Library | Version | Purpose | Why Removing |
|---------|---------|---------|--------------|
| dartz | ^0.10.1 | `Either<L,R>`, `Unit`, `Left`, `Right` | Replaced by sealed `Result<T>` type |

### No New Dependencies
This phase removes dartz and uses no new libraries.

## Architecture Patterns

### Migration Pattern (Established in Phase 03-01/03-02)

**Step-by-step per repository:**

1. **Interface** (`lib/domain/repositories/`):
   - Replace `import 'package:dartz/dartz.dart'` with `import '../../core/errors/result.dart'`
   - Change `Future<Either<Failure, T>>` to `Future<Result<T>>`
   - Change `Future<Either<Failure, Unit>>` to `Future<Result<void>>`
   - Remove `Failure` import if only used for Either (keep if used elsewhere)

2. **Implementation** (`lib/data/repositories/`):
   - Replace `import 'package:dartz/dartz.dart'` with `import '../../core/errors/exception_mapper.dart'` and `import '../../core/errors/result.dart'`
   - Replace `Left(SomeFailure(...))` with `Result.failure(SomeFailure(...))`
   - Replace `Right(value)` with `Result.success(value)`
   - Replace `Right(null)` / `Right(const null)` with `Result.success(null)` for `Result<void>`
   - Replace `Right(unit)` / `const Right(unit)` with `Result.success(null)` for `Result<void>`
   - For simple CRUD: wrap with `runCatching(() async { ... }, context: 'methodName')`
   - For complex methods with not-found/validation: use explicit `try/catch` + `mapException()`

3. **Provider consumers** (`lib/presentation/providers/`):
   - Replace `.fold((failure) => ..., (value) => ...)` with `switch (result) { case Success(:final value): ... case ResultFailure(:final failure): ... }`
   - Replace `.isLeft()` / `.isRight()` with `.isFailure` / `.isSuccess`
   - Replace `.fold((l) => l, (r) => null)` with `.failureOrNull`
   - Replace `.fold((l) => '', (r) => r)` with `.valueOrNull ?? ''`

4. **Screen consumers** (`lib/presentation/screens/`):
   - Same pattern as providers -- replace `.fold()` with `switch` or `.when()`

5. **Tests** (`test/`):
   - Replace `isA<Right>()` with `isA<Success>()`
   - Replace `isA<Left>()` with `isA<ResultFailure>()`
   - Replace `(result as Right).value` with `(result as Success).value`
   - Replace `(result as Left).value` with `(result as ResultFailure).failure`
   - Remove `import 'package:dartz/dartz.dart'`

### Repository-Specific Notes

#### 1. AuthRepository (MOST COMPLEX)
- **11 methods** returning `Either<Failure, T>`: signIn, signOut, refreshSession, requestPasswordReset, updatePassword, updateProfile, uploadProfilePhoto, removeProfilePhoto
- **Unique patterns**: Uses `Left(AuthFailure(...))` extensively with custom `_mapAuthError()` helper
- **Consumer files**: auth_providers.dart (LoginNotifier), profile_providers.dart (ProfilePhotoNotifier), reset_password_screen.dart, forgot_password_screen.dart, change_password_screen.dart, edit_profile_screen.dart
- **Profile providers use `.isLeft()` / `.fold((l) => l, (r) => null)`** pattern -- needs full rewrite to switch/Result API
- **Test impact**: auth_repository_impl_test.dart (uses dartz), test_helpers.dart (FakeAuthRepository returns Either), customer_test_helpers.dart (FakeCustomerRepository -- already migrated to Result, but file still imports dartz for FakeAuthRepository compatibility)
- **Auth-specific**: Does NOT use mapException/runCatching pattern since it has its own `_mapAuthError` helper and custom error handling. Migrate to use `mapException()` where appropriate OR keep auth-specific error mapping with Result wrapper.

#### 2. AdminUserRepository (MEDIUM)
- **6 methods** returning `Either<Failure, T>`: createUser, updateUser, deactivateUser, activateUser, generateTemporaryPassword, updateUserHierarchy
- **Implementation pattern**: Direct Supabase remote calls, no local DB, generic `DatabaseFailure` catch-all
- **Consumer files**: admin_user_providers.dart (6 `.fold()` call sites)
- **No tests** (no test files exist)
- **Note**: List/search methods throw raw exceptions (not Either-wrapped). These are OUT OF SCOPE -- only migrate methods that currently return Either.

#### 3. AdminMasterDataRepository (MEDIUM)
- **11 methods** returning `Either<Failure, T>`: createEntity, createProvince, createCity, createCompanyType, createIndustry, createPipelineStage, updateEntity, bulkToggleActive, softDeleteEntity, hardDeleteEntity, softDeleteRegionalOffice, softDeleteBranch, activateEntity, deactivateEntity, validateDelete
- **Implementation pattern**: Direct Supabase remote calls, no local DB, generic `DatabaseFailure` catch-all
- **Consumer files**: master_data_form_screen.dart (3 `.fold()` call sites), master_data_list_screen.dart (1 `.fold()` call site + imports dartz directly)
- **No tests** (no test files exist)

#### 4. BrokerRepository (SIMPLE)
- **4 methods** returning `Either<Failure, T>`: createBroker, updateBroker, deleteBroker, syncFromRemote
- **Implementation pattern**: Offline-first with Drift + sync queue, same pattern as Customer
- **Consumer files**: broker_providers.dart (3 `.fold()` call sites), sync_providers.dart (1 `.fold()` for syncFromRemote)
- **No tests** (no test files exist)

#### 5. HvcRepository (MEDIUM)
- **6 methods** returning `Either<Failure, T>`: createHvc, updateHvc, deleteHvc, linkCustomerToHvc, unlinkCustomerFromHvc, syncFromRemote, syncLinksFromRemote
- **Implementation pattern**: Offline-first with Drift + sync queue, same as Customer
- **Consumer files**: hvc_providers.dart (5 `.fold()` call sites), sync_providers.dart (2 `.fold()` for syncFromRemote/syncLinksFromRemote)
- **No tests** (no test files exist)

#### 6. CadenceRepository (MOST METHODS)
- **18 methods** returning `Either<Failure, T>`: createConfig, updateConfig, toggleConfigActive, deleteConfig, startMeeting, endMeeting, cancelMeeting, updateMeetingNotes, updateMeetingAgenda, submitPreMeetingForm, saveFormDraft, markAttendance, batchMarkAttendance, saveHostNotes, saveFeedback, ensureUpcomingMeetings (plus internal `.fold()` in batchMarkAttendance)
- **SPECIAL**: 5 methods return `Either<Failure, Unit>` where `Unit` is from dartz -- must become `Result<void>`
- **INTERNAL .fold()**: `batchMarkAttendance()` calls `markAttendance().fold()` internally in the impl -- this must also be migrated
- **Consumer files**: cadence_providers.dart (10 `.fold()` call sites), cadence_detail_screen.dart (4 `.fold()`), host_dashboard_screen.dart (1 `.fold()`), cadence_form_screen.dart (2 `.fold()`)
- **No tests** (no test files exist)

#### 7. PipelineReferralRepository (MEDIUM-COMPLEX)
- **6 methods** returning `Either<Failure, T>`: createReferral, acceptReferral, rejectReferral, approveReferral, rejectAsManager, cancelReferral
- **Implementation pattern**: Offline-first with Drift + sync queue + lookup caches
- **Consumer files**: pipeline_referral_providers.dart (6 `.fold()` call sites + 6 `.isRight()` calls)
- **No tests** (no test files exist)

### Pre-Existing Bug: key_person_form_sheet.dart

**CRITICAL FINDING**: `lib/presentation/screens/customer/key_person_form_sheet.dart` currently calls `.fold()` on `Result<KeyPerson>` returned from `CustomerRepository.updateKeyPerson()` and `addKeyPerson()`. Since `Result` does not have a `.fold()` method, this causes **compilation errors** right now:
```
error - The method 'fold' isn't defined for the type 'Result' - key_person_form_sheet.dart:318:16
error - The method 'fold' isn't defined for the type 'Result' - key_person_form_sheet.dart:344:16
```
This is a leftover from the Phase 3 migration (missed consumer). It should be fixed as part of this phase or as a pre-existing bug fix.

### Consumer Call Site Inventory

Complete list of files needing `.fold()` to `switch` migration:

| File | Repo | .fold() Count | .isLeft()/.isRight() | Notes |
|------|------|--------------|---------------------|-------|
| `providers/auth_providers.dart` | Auth | 1 | 0 | LoginNotifier |
| `providers/profile_providers.dart` | Auth | 4 | 3 (.isLeft) | Uses `.fold((l)=>l, (r)=>null)` pattern |
| `screens/auth/reset_password_screen.dart` | Auth | 1 | 0 | Direct repo call |
| `screens/auth/forgot_password_screen.dart` | Auth | 1 | 0 | Direct repo call |
| `screens/profile/edit_profile_screen.dart` | Auth | 1 | 0 | Direct repo call |
| `screens/profile/change_password_screen.dart` | Auth | 1 | 0 | Direct repo call |
| `providers/admin_user_providers.dart` | AdminUser | 6 | 0 | |
| `screens/admin/master_data/master_data_form_screen.dart` | AdminMasterData | 3 | 0 | |
| `screens/admin/master_data/master_data_list_screen.dart` | AdminMasterData | 1 | 0 | Also imports dartz directly |
| `providers/broker_providers.dart` | Broker | 3 | 0 | |
| `providers/sync_providers.dart` | Broker+HVC | 3 | 0 | hvc, hvcLink, broker sync results |
| `providers/hvc_providers.dart` | HVC | 5 | 0 | |
| `providers/cadence_providers.dart` | Cadence | 10 | 0 | |
| `screens/cadence/cadence_detail_screen.dart` | Cadence | 4 | 0 | |
| `screens/cadence/host_dashboard_screen.dart` | Cadence | 1 | 0 | |
| `screens/cadence/cadence_form_screen.dart` | Cadence | 2 | 0 | |
| `providers/pipeline_referral_providers.dart` | PipelineReferral | 6 | 6 (.isRight) | |
| `data/repositories/cadence_repository_impl.dart` | Cadence (internal) | 1 | 0 | batchMarkAttendance calls markAttendance().fold() |
| `screens/customer/key_person_form_sheet.dart` | Customer (PRE-EXISTING BUG) | 2 | 0 | Already broken -- Result has no .fold() |

**Total**: ~56 `.fold()` call sites + 9 `.isLeft()`/`.isRight()` calls across 18 files.

### Test Files Requiring Updates

| File | Current dartz Usage | Update Needed |
|------|--------------------|---------------|
| `test/data/repositories/auth_repository_impl_test.dart` | `import dartz`, `isA<Right>()`, `isA<Left>()` | Full assertion migration |
| `test/helpers/test_helpers.dart` | `FakeAuthRepository` returns `Either<Failure, T>` | Change to `Result<T>` |
| `test/helpers/customer_test_helpers.dart` | Imports dartz (for FakeCustomerRepository) | Check if dartz import still needed after FakeAuthRepository changes |

### Final Cleanup

After all 7 repos are migrated:
1. Remove `dartz: ^0.10.1` from `pubspec.yaml` dependencies
2. Remove `EitherToResult` extension from `lib/core/errors/result.dart` (lines 104-114)
3. Remove `import 'package:dartz/dartz.dart' show Either;` from `result.dart` (line 1)
4. Run `flutter pub get` to verify no remaining dartz dependency
5. Run `grep -r "dartz" lib/ test/` to verify zero remaining imports

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Error classification | Custom try/catch per method | `mapException()` from `exception_mapper.dart` | Already classifies 6+ exception types consistently |
| Async result wrapping | Manual try/catch + Result.success/failure | `runCatching()` from `exception_mapper.dart` | Eliminates boilerplate for simple CRUD |
| Result type | New sealed class or extension | Existing `Result<T>` from `result.dart` | Battle-tested, has convenience methods (.when, .valueOrNull, etc.) |

**Key insight:** This is a mechanical migration, not a design exercise. Every pattern is already established and proven. The only creativity needed is in choosing `runCatching` vs explicit `try/catch + mapException` per method.

## Common Pitfalls

### Pitfall 1: Missing Consumer Call Sites
**What goes wrong:** Change repository interface to Result, but miss a screen/provider that calls `.fold()` on the old Either return type. Compilation breaks at runtime or in CI.
**Why it happens:** `.fold()` call sites can be in providers, screens, other repository impls (like batchMarkAttendance), and test helpers -- not just the obvious notifier.
**How to avoid:** Before changing each interface, grep for ALL consumers: `grep -r "repoName\.\|_repository\." lib/ test/` and check every call site for `.fold()`, `.isLeft()`, `.isRight()`, `Left(`, `Right(`.
**Warning signs:** `flutter analyze` errors about undefined method 'fold' on type 'Result'.

### Pitfall 2: dartz Unit vs Dart void
**What goes wrong:** Cadence repository uses `Either<Failure, Unit>` (dartz Unit) in 5 return types. Direct mechanical replacement to `Result<Unit>` fails because Unit is from dartz.
**Why it happens:** `Unit` is a dartz type with no Dart stdlib equivalent.
**How to avoid:** Replace `Either<Failure, Unit>` with `Result<void>`. Replace `Right(unit)` / `const Right(unit)` with `Result.success(null)`. Consumers that extract the value can just use `case Success()` without destructuring.
**Warning signs:** Import errors for `Unit` after removing dartz import.

### Pitfall 3: Auth Repository Error Mapping Divergence
**What goes wrong:** Auth repo has its own `_mapAuthError()` helper and constructs failures manually (e.g., `Left(AuthFailure(message: _mapAuthError(e.message)))`) instead of using `mapException()`.
**Why it happens:** Auth was built before the centralized `mapException()` was created.
**How to avoid:** For auth, keep the existing error classification logic but wrap in Result. Do NOT blindly replace with `runCatching` -- the auth-specific error messages (Indonesian locale) and the special `_mapAuthError` logic must be preserved. Use `Result.failure(AuthFailure(...))` instead of `Left(AuthFailure(...))`.
**Warning signs:** Auth error messages changing unexpectedly after migration.

### Pitfall 4: Profile Providers `.isLeft()` Pattern
**What goes wrong:** `profile_providers.dart` uses a non-standard pattern: `uploadResult.isLeft()` check, then `uploadResult.fold((l) => l, (r) => null)` to extract the failure. This doesn't map to a simple switch.
**Why it happens:** Profile photo upload is a multi-step operation (upload + update profile) with manual Left/Right checking between steps.
**How to avoid:** Rewrite using `switch` or `.when()` for each step, or use `.isFailure` / `.failureOrNull` / `.valueOrNull` helpers that already exist on Result.
**Warning signs:** Complex nested fold patterns that don't translate to simple switch.

### Pitfall 5: Removing dartz Too Early
**What goes wrong:** Removing dartz from pubspec.yaml before ALL files are migrated causes cascading compilation failures.
**Why it happens:** Some file you forgot still imports dartz.
**How to avoid:** dartz removal MUST be the absolute last step, after ALL 7 repos, ALL consumers, ALL tests are migrated. Verify with `grep -r "dartz" lib/ test/` returning zero results before removing.
**Warning signs:** `flutter pub get` or `flutter analyze` fails after removal.

### Pitfall 6: FakeAuthRepository in Test Helpers
**What goes wrong:** `test/helpers/test_helpers.dart` contains `FakeAuthRepository` implementing `AuthRepository` with `Either<Failure, T>` return types. When the interface changes to `Result<T>`, this fake must also be updated.
**Why it happens:** Test fakes implement the same interface -- they break when the interface changes.
**How to avoid:** Update FakeAuthRepository simultaneously with the interface change. Also check `customer_test_helpers.dart` which imports dartz.
**Warning signs:** Test compilation failures.

## Code Examples

### Pattern 1: Simple CRUD with runCatching (Broker)

**Before (dartz):**
```dart
Future<Either<Failure, void>> deleteBroker(String id) async {
  try {
    await _database.transaction(() async {
      await localDataSource.softDeleteBroker(id);
      await syncService.queueOperation(...);
    });
    unawaited(syncService.triggerSync());
    return const Right(null);
  } catch (e) {
    return Left(DatabaseFailure(message: 'Failed to delete broker: $e'));
  }
}
```

**After (Result):**
```dart
Future<Result<void>> deleteBroker(String id) =>
  runCatching(() async {
    await _database.transaction(() async {
      await localDataSource.softDeleteBroker(id);
      await syncService.queueOperation(...);
    });
    unawaited(syncService.triggerSync());
  }, context: 'deleteBroker');
```

### Pattern 2: Complex Method with Validation (Referral)

**Before (dartz):**
```dart
Future<Either<Failure, PipelineReferral>> acceptReferral(String id, String? notes) async {
  try {
    final existing = await _localDataSource.getReferralById(id);
    if (existing == null) {
      return Left(NotFoundFailure(message: 'Referral not found: $id'));
    }
    if (existing.status != 'PENDING_RECEIVER') {
      return Left(ValidationFailure(message: '...'));
    }
    // ... do work ...
    return Right(referral!);
  } catch (e) {
    return Left(DatabaseFailure(message: 'Failed to accept referral: $e'));
  }
}
```

**After (Result):**
```dart
Future<Result<PipelineReferral>> acceptReferral(String id, String? notes) async {
  try {
    final existing = await _localDataSource.getReferralById(id);
    if (existing == null) {
      return Result.failure(NotFoundFailure(message: 'Referral not found: $id'));
    }
    if (existing.status != 'PENDING_RECEIVER') {
      return Result.failure(ValidationFailure(message: '...'));
    }
    // ... do work ...
    return Result.success(referral!);
  } catch (e) {
    return Result.failure(mapException(e, context: 'acceptReferral'));
  }
}
```

### Pattern 3: Provider Consumer Migration

**Before (dartz .fold()):**
```dart
result.fold(
  (failure) {
    state = state.copyWith(isLoading: false, errorMessage: failure.message);
  },
  (value) {
    state = state.copyWith(isLoading: false, savedItem: value);
  },
);
```

**After (Result switch):**
```dart
switch (result) {
  case Success(:final value):
    state = state.copyWith(isLoading: false, savedItem: value);
  case ResultFailure(:final failure):
    state = state.copyWith(isLoading: false, errorMessage: failure.message);
}
```

### Pattern 4: Profile Providers .isLeft() Migration

**Before (dartz .isLeft() + .fold() extraction):**
```dart
if (uploadResult.isLeft()) {
  final failure = uploadResult.fold((l) => l, (r) => null);
  state = state.copyWith(isLoading: false, errorMessage: failure?.message ?? 'Upload gagal');
  return false;
}
final photoUrl = uploadResult.fold((l) => '', (r) => r);
```

**After (Result API):**
```dart
switch (uploadResult) {
  case ResultFailure(:final failure):
    state = state.copyWith(isLoading: false, errorMessage: failure.message);
    return false;
  case Success(:final value):
    final photoUrl = value;
    // continue with photoUrl...
}
```

### Pattern 5: dartz Unit to void

**Before (dartz):**
```dart
// Interface:
Future<Either<Failure, Unit>> deleteConfig(String configId);

// Implementation:
return const Right(unit);
```

**After (Result):**
```dart
// Interface:
Future<Result<void>> deleteConfig(String configId);

// Implementation:
return Result.success(null);
```

### Pattern 6: Internal .fold() in Repository Implementation (Cadence batchMarkAttendance)

**Before (dartz):**
```dart
result.fold(
  (failure) => throw Exception(failure.message),
  (participant) => results.add(participant),
);
```

**After (Result):**
```dart
switch (result) {
  case Success(:final value):
    results.add(value);
  case ResultFailure(:final failure):
    throw Exception(failure.message);
}
```

### Pattern 7: Screen-Level Consumer with mounted Check

**Before (dartz .fold()):**
```dart
result.fold(
  (failure) {
    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Error: ${failure.message}')),
      );
    }
  },
  (value) {
    if (mounted) {
      Navigator.pop(context);
    }
  },
);
```

**After (Result switch):**
```dart
switch (result) {
  case Success():
    if (mounted) {
      Navigator.pop(context);
    }
  case ResultFailure(:final failure):
    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Error: ${failure.message}')),
      );
    }
}
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| `dartz Either<Failure, T>` | Sealed `Result<T>` | Phase 03-01 (2026-02-13) | Exhaustive pattern matching, no dartz dependency |
| `.fold((l) => ..., (r) => ...)` | `switch` with destructuring | Phase 03-01 (2026-02-13) | Dart 3 idiomatic, compiler-checked |
| Inline `DatabaseFailure` construction | `mapException()` classification | Phase 03-01 (2026-02-13) | Consistent error typing across all repos |
| Manual try/catch + Left/Right | `runCatching()` for simple CRUD | Phase 03-01 (2026-02-13) | Reduced boilerplate |

**Deprecated/outdated:**
- `dartz`: Package not maintained since 2023. Being removed entirely.
- `Either<Failure, T>`: Replaced by sealed `Result<T>` with Dart 3 patterns.
- `Unit` from dartz: Replace with `void` (Dart native).
- `EitherToResult` adapter: Temporary bridge, to be removed after this phase.

## Open Questions

1. **Auth repo error mapping: keep custom `_mapAuthError` or centralize?**
   - What we know: Auth has custom Indonesian-locale error messages in `_mapAuthError()` that translate Supabase auth errors
   - What's unclear: Whether `mapException()` should absorb this logic or keep it separate
   - Recommendation: Keep `_mapAuthError()` as-is for auth-specific messages. Only change `Left()/Right()` to `Result.failure()/Result.success()`. Don't try to centralize auth error mapping -- it's domain-specific and working fine.

2. **Pre-existing key_person_form_sheet.dart bug -- fix here or separately?**
   - What we know: Currently causes compilation errors (`.fold()` called on `Result`)
   - What's unclear: Whether this should be a separate bug-fix PR
   - Recommendation: Fix inline during this phase since it's the same mechanical migration (`.fold()` to `switch`). It's 2 call sites in 1 file.

## Sources

### Primary (HIGH confidence)
- `lib/core/errors/result.dart` - Sealed Result type definition, read directly from codebase
- `lib/core/errors/exception_mapper.dart` - mapException() and runCatching(), read directly
- `lib/data/repositories/customer_repository_impl.dart` - Reference migration pattern, read directly
- `lib/presentation/providers/pipeline_providers.dart` - Reference consumer pattern, read directly
- `.planning/phases/03-error-classification-recovery/03-01-SUMMARY.md` - Phase 3 decisions and patterns
- `.planning/phases/03-error-classification-recovery/03-02-SUMMARY.md` - Phase 3 decisions and patterns
- `flutter analyze` output - Verified key_person_form_sheet.dart compilation errors

### Secondary (MEDIUM confidence)
- All 7 repository interfaces and implementations - read directly from codebase
- All provider and screen consumer files - grep + read for .fold() usage
- pubspec.yaml - verified dartz ^0.10.1 dependency

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - all patterns from existing codebase, no external research needed
- Architecture: HIGH - exact same pattern applied 3 times already in Phase 3
- Pitfalls: HIGH - based on actual Phase 3 deviation reports and code analysis
- Consumer inventory: HIGH - exhaustive grep of all .fold(), .isLeft(), .isRight(), Left(, Right( in codebase

**Research date:** 2026-02-14
**Valid until:** 2026-03-14 (stable -- internal codebase patterns, no external dependency changes expected)

## Method Count Summary

| Repository | Either Methods | Consumer Files | .fold() Sites | Test Files |
|------------|---------------|----------------|---------------|------------|
| Auth | 8 | 6 | 9 + 3 .isLeft | 1 + 2 helpers |
| AdminUser | 6 | 1 | 6 | 0 |
| AdminMasterData | ~14 | 2 | 4 | 0 |
| Broker | 4 | 2 | 4 | 0 |
| HVC | 7 | 2 | 7 | 0 |
| Cadence | 18 | 4 | 17 + 1 internal | 0 |
| PipelineReferral | 6 | 1 | 6 + 6 .isRight | 0 |
| **TOTAL** | **63** | **18** | **~56 + 9 isLeft/Right + 1 internal** | **3** |
| Pre-existing bug | - | 1 | 2 | 0 |
