---
phase: 03.1-remaining-repo-result-migration
plan: 05
subsystem: errors
tags: [dartz, result, sealed-class, error-handling, dependency-removal]

# Dependency graph
requires:
  - phase: 03.1-remaining-repo-result-migration (plans 01-04)
    provides: All 7 repositories migrated from dartz Either to sealed Result
provides:
  - dartz dependency removed from project
  - Clean Result type without migration bridge adapter
  - Zero dartz references in entire codebase
affects: [all-future-phases, pubspec, error-handling]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "All repositories use sealed Result<T> from core/errors/result.dart"
    - "No external functional programming dependency"

key-files:
  created: []
  modified:
    - lib/core/errors/result.dart
    - pubspec.yaml
    - pubspec.lock
    - test/helpers/customer_test_helpers.dart

key-decisions:
  - "FakeCustomerRepository updated to match current interface including watch methods"
  - "Removed dartz comment reference in Result.when() doc comment"

patterns-established:
  - "Result<T> is the sole error-handling pattern -- no dartz dependency"

# Metrics
duration: 8min
completed: 2026-02-14
---

# Phase 3.1 Plan 05: Remove dartz Dependency Summary

**Removed dartz dependency entirely -- clean sealed Result<T> type with zero external FP library coupling**

## Performance

- **Duration:** 8 min
- **Started:** 2026-02-13T22:05:44Z
- **Completed:** 2026-02-13T22:13:19Z
- **Tasks:** 1
- **Files modified:** 4

## Accomplishments
- Removed dartz from pubspec.yaml, confirmed package resolution succeeds without it
- Removed EitherToResult bridge extension from result.dart (no longer needed)
- Verified zero dartz references in entire lib/ and test/ codebase
- All 55 repository tests pass; flutter analyze shows zero errors

## Task Commits

Each task was committed atomically:

1. **Task 1: Verify zero dartz usage and remove dependency** - `ed5f314` (chore)

## Files Created/Modified
- `lib/core/errors/result.dart` - Removed dartz import and EitherToResult extension
- `pubspec.yaml` - Removed dartz dependency
- `pubspec.lock` - Updated lock file (dartz removed)
- `test/helpers/customer_test_helpers.dart` - Migrated FakeCustomerRepository from Either to Result, added missing interface methods

## Decisions Made
- Updated FakeCustomerRepository to match current CustomerRepository interface (added watchCustomerById, watchCustomersPaginated, getCustomerCount, watchCustomerKeyPersons, watchPrimaryKeyPerson)
- Fixed CustomerFormNotifier constructor call (now takes 1 arg, not 2) and customerDetailProvider override (now StreamProvider, not FutureProvider) in test helpers
- Removed dartz reference from Result.when() doc comment

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] FakeCustomerRepository still used dartz Either types**
- **Found during:** Task 1 (Pre-removal verification)
- **Issue:** test/helpers/customer_test_helpers.dart imported dartz and used Either<Failure, T> return types; FakeCustomerRepository was missing interface methods added since migration
- **Fix:** Replaced dartz import with Result import, changed all Either/Left/Right to Result/Result.failure/Result.success, added missing interface methods (watchCustomerById, watchCustomersPaginated, getCustomerCount, watchCustomerKeyPersons, watchPrimaryKeyPerson)
- **Files modified:** test/helpers/customer_test_helpers.dart
- **Verification:** grep returns zero dartz references in test/
- **Committed in:** ed5f314 (part of task commit)

**2. [Rule 1 - Bug] CustomerFormNotifier constructor and customerDetailProvider override stale**
- **Found during:** Task 1 (Post-removal test compilation check)
- **Issue:** FakeCustomerRepository test helpers passed 2 args to CustomerFormNotifier (now takes 1) and used async Future override for customerDetailProvider (now a StreamProvider)
- **Fix:** Changed CustomerFormNotifier(ref, customerRepo) to CustomerFormNotifier(customerRepo), changed customerDetailProvider override from async Future to Stream via watchCustomerById
- **Files modified:** test/helpers/customer_test_helpers.dart
- **Verification:** Customer test files compile successfully
- **Committed in:** ed5f314 (part of task commit)

---

**Total deviations:** 2 auto-fixed (1 blocking, 1 bug)
**Impact on plan:** Both auto-fixes necessary for dartz removal. The test helpers were the last file still importing dartz and needed migration to complete the cleanup. No scope creep.

## Issues Encountered
- 13 pre-existing test failures (AppLogger not initialized, missing fake method implementations in mock_sync_infrastructure.dart, etc.) -- not caused by this plan's changes. All 55 repository tests pass.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Phase 3.1 is fully complete: all 10 repositories migrated from dartz Either to sealed Result
- dartz dependency removed, project is lighter and uses only native Dart 3 sealed classes for error handling
- Ready to proceed to Phase 4 (Sync Engine Enhancement)

## Self-Check: PASSED

All files verified present, all commits verified in git log.

---
*Phase: 03.1-remaining-repo-result-migration*
*Completed: 2026-02-14*
